
import {assert, assMatch} from 'sjtest';
import {asNum} from 'wwutils';
import DataClass from './DataClass';
import C from '../CBase';

/** impact utils */
class Claim extends DataClass {
	/**
	 * @type {!String}
	 */
	k;
	v;
	/** @type {TimeString} */
	t = new Date().toISOString();
	/** @type {XIdString[]} */
	f;
	/** @type {String[]} */
	c;

	/** Puts data into the "Claim" format that Profiler can understand 
	 *  NB: if Claim is generated by user input (entering a value in to PropControl field)
	 * 	then 'from' should contain 'myloop@app' 
	 * @param {String} key
	 * @param {String[]|boolean} c - e.g. ['public']
	 * @param {String[]|boolean} consent - Same as c!
	 * 
	*/
	constructor({key, value, from, c, consent}) {
		super(); // no base passed into super 'cos its handled below
		// convert a single XId to an array?
		if (_.isString(from)) from = [from];	
		// Converting from internally held true/false to something
		// That the back-end can understand
		if ( typeof c === 'boolean' ) c = c ? ['public'] : ['private']
		assMatch(c, 'String[]');

		let base = {
			c: c || consent,
			v: value,
			f: from,
			k: key
		};
		Object.assign(this, base);
		assMatch(from, 'String[]');
		assMatch(key, String); 
		// NB: kv, o are backend fields made by the backend for internal (ES) use
	};
} // ./Claim
DataClass.register(Claim, "Claim");
const This = Claim;
export default Claim;


/**
 * ??dubious use cases
 */
Claim.getClaims = person => {
	if ( ! person ) return {};
	Person.assIsa(person, "Profiler.js getClaims");
	const claims = person.claims;
	return claims || {};
};

